<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>炸毁敌机</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            overflow: hidden;
        }
        .header {
            background: rgba(255,255,255,0.1);
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            backdrop-filter: blur(10px);
        }
        .header h1 { color: white; font-size: 24px; }
        .game-info { color: white; font-size: 14px; }
        .game-container {
            position: relative;
            margin-top: 20px;
        }
        canvas {
            border: 3px solid #667eea;
            border-radius: 10px;
            box-shadow: 0 0 30px rgba(102, 126, 234, 0.5);
        }
        .controls {
            margin-top: 20px;
            text-align: center;
            color: white;
        }
        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            margin: 5px;
            transition: all 0.3s;
        }
        .btn-start { background: linear-gradient(45deg, #43e97b, #38f9d7); color: white; }
        .btn-back { background: linear-gradient(45deg, #f093fb, #f5576c); color: white; }
        .btn:hover { transform: scale(1.05); }
        .instructions {
            color: rgba(255,255,255,0.7);
            font-size: 12px;
            margin-top: 15px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>✈️ 炸毁敌机</h1>
        <div class="game-info">
            分数: <span id="score">0</span> | 关卡: <span id="level">1</span> | 生命: <span id="lives">3</span>
        </div>
        <button class="btn btn-back" onclick="location.href='../index.html'">返回</button>
    </div>
    
    <div class="game-container">
        <canvas id="gameCanvas" width="600" height="500"></canvas>
    </div>
    
    <div class="controls">
        <button class="btn btn-start" id="startBtn" onclick="startGame()">开始游戏</button>
        <div class="instructions">
            使用 ← → 方向键或 A D 键移动战机<br>
            空格键发射子弹 | P 键暂停
        </div>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        
        let gameRunning = false;
        let gamePaused = false;
        let score = 0;
        let level = 1;
        let lives = 3;
        
        const player = {
            x: 275,
            y: 450,
            width: 50,
            height: 40,
            speed: 7,
            color: '#4facfe'
        };
        
        let bullets = [];
        let enemies = [];
        let enemyBullets = [];
        let explosions = [];
        
        const keys = {};
        
        document.addEventListener('keydown', (e) => {
            keys[e.key] = true;
            if (e.key === ' ') {
                e.preventDefault();
                if (gameRunning && !gamePaused) shoot();
            }
            if (e.key === 'p' || e.key === 'P') {
                togglePause();
            }
        });
        
        document.addEventListener('keyup', (e) => {
            keys[e.key] = false;
        });
        
        function shoot() {
            bullets.push({
                x: player.x + player.width / 2 - 2,
                y: player.y,
                width: 4,
                height: 15,
                speed: 10
            });
        }
        
        function createEnemy() {
            const enemy = {
                x: Math.random() * (canvas.width - 40),
                y: -40,
                width: 40,
                height: 35,
                speed: 2 + level * 0.3,
                color: '#ff6b6b',
                shootTimer: 0
            };
            enemies.push(enemy);
        }
        
        function createExplosion(x, y) {
            explosions.push({
                x: x,
                y: y,
                radius: 5,
                maxRadius: 30,
                alpha: 1
            });
        }
        
        function update() {
            if (!gameRunning || gamePaused) return;
            
            // 移动玩家
            if ((keys['ArrowLeft'] || keys['a'] || keys['A']) && player.x > 0) {
                player.x -= player.speed;
            }
            if ((keys['ArrowRight'] || keys['d'] || keys['D']) && player.x < canvas.width - player.width) {
                player.x += player.speed;
            }
            
            // 更新子弹
            bullets = bullets.filter(bullet => {
                bullet.y -= bullet.speed;
                return bullet.y > -bullet.height;
            });
            
            // 更新敌人
            enemies.forEach(enemy => {
                enemy.y += enemy.speed;
                
                // 敌人射击
                enemy.shootTimer++;
                if (enemy.shootTimer > 100 - level * 5) {
                    enemy.shootTimer = 0;
                    enemyBullets.push({
                        x: enemy.x + enemy.width / 2 - 2,
                        y: enemy.y + enemy.height,
                        width: 4,
                        height: 10,
                        speed: 4
                    });
                }
            });
            
            // 更新敌人子弹
            enemyBullets = enemyBullets.filter(bullet => {
                bullet.y += bullet.speed;
                return bullet.y < canvas.height;
            });
            
            // 移除超出屏幕的敌人
            enemies = enemies.filter(enemy => {
                if (enemy.y > canvas.height) {
                    lives--;
                    updateUI();
                    if (lives <= 0) gameOver();
                    return false;
                }
                return true;
            });
            
            // 碰撞检测：子弹击中敌人
            bullets.forEach((bullet, bi) => {
                enemies.forEach((enemy, ei) => {
                    if (collision(bullet, enemy)) {
                        createExplosion(enemy.x + enemy.width / 2, enemy.y + enemy.height / 2);
                        enemies.splice(ei, 1);
                        bullets.splice(bi, 1);
                        score += 10;
                        updateUI();
                        
                        // 升级
                        if (score >= level * 100) {
                            level++;
                            updateUI();
                        }
                    }
                });
            });
            
            // 碰撞检测：敌人子弹击中玩家
            enemyBullets.forEach((bullet, bi) => {
                if (collision(bullet, player)) {
                    enemyBullets.splice(bi, 1);
                    lives--;
                    updateUI();
                    if (lives <= 0) gameOver();
                }
            });
            
            // 碰撞检测：敌人撞击玩家
            enemies.forEach((enemy, ei) => {
                if (collision(enemy, player)) {
                    createExplosion(enemy.x + enemy.width / 2, enemy.y + enemy.height / 2);
                    enemies.splice(ei, 1);
                    lives--;
                    updateUI();
                    if (lives <= 0) gameOver();
                }
            });
            
            // 更新爆炸效果
            explosions = explosions.filter(exp => {
                exp.radius += 2;
                exp.alpha -= 0.05;
                return exp.alpha > 0;
            });
            
            // 生成新敌人
            if (Math.random() < 0.02 + level * 0.005) {
                createEnemy();
            }
        }
        
        function collision(a, b) {
            return a.x < b.x + b.width &&
                   a.x + a.width > b.x &&
                   a.y < b.y + b.height &&
                   a.y + a.height > b.y;
        }
        
        function draw() {
            // 清空画布
            ctx.fillStyle = '#0a0a1a';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // 绘制星空背景
            ctx.fillStyle = 'rgba(255, 255, 255, 0.5)';
            for (let i = 0; i < 50; i++) {
                const x = (i * 73 + Date.now() * 0.01) % canvas.width;
                const y = (i * 47 + Date.now() * 0.02) % canvas.height;
                ctx.fillRect(x, y, 2, 2);
            }
            
            // 绘制玩家
            ctx.fillStyle = player.color;
            ctx.beginPath();
            ctx.moveTo(player.x + player.width / 2, player.y);
            ctx.lineTo(player.x + player.width, player.y + player.height);
            ctx.lineTo(player.x + player.width / 2, player.y + player.height - 10);
            ctx.lineTo(player.x, player.y + player.height);
            ctx.closePath();
            ctx.fill();
            
            // 绘制子弹
            ctx.fillStyle = '#feca57';
            bullets.forEach(bullet => {
                ctx.fillRect(bullet.x, bullet.y, bullet.width, bullet.height);
            });
            
            // 绘制敌人
            enemies.forEach(enemy => {
                ctx.fillStyle = enemy.color;
                ctx.beginPath();
                ctx.moveTo(enemy.x + enemy.width / 2, enemy.y + enemy.height);
                ctx.lineTo(enemy.x + enemy.width, enemy.y);
                ctx.lineTo(enemy.x + enemy.width / 2, enemy.y + 10);
                ctx.lineTo(enemy.x, enemy.y);
                ctx.closePath();
                ctx.fill();
            });
            
            // 绘制敌人子弹
            ctx.fillStyle = '#ff9f43';
            enemyBullets.forEach(bullet => {
                ctx.fillRect(bullet.x, bullet.y, bullet.width, bullet.height);
            });
            
            // 绘制爆炸
            explosions.forEach(exp => {
                ctx.beginPath();
                ctx.arc(exp.x, exp.y, exp.radius, 0, Math.PI * 2);
                ctx.fillStyle = `rgba(255, 107, 107, ${exp.alpha})`;
                ctx.fill();
            });
            
            // 暂停提示
            if (gamePaused) {
                ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                ctx.fillStyle = 'white';
                ctx.font = '30px Microsoft YaHei';
                ctx.textAlign = 'center';
                ctx.fillText('游戏暂停', canvas.width / 2, canvas.height / 2);
            }
        }
        
        function gameLoop() {
            update();
            draw();
            if (gameRunning) {
                requestAnimationFrame(gameLoop);
            }
        }
        
        function startGame() {
            if (gameRunning) return;
            
            gameRunning = true;
            gamePaused = false;
            score = 0;
            level = 1;
            lives = 3;
            player.x = 275;
            bullets = [];
            enemies = [];
            enemyBullets = [];
            explosions = [];
            
            updateUI();
            document.getElementById('startBtn').textContent = '游戏中...';
            gameLoop();
        }
        
        function gameOver() {
            gameRunning = false;
            ctx.fillStyle = 'rgba(0, 0, 0, 0.8)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = 'white';
            ctx.font = '30px Microsoft YaHei';
            ctx.textAlign = 'center';
            ctx.fillText('游戏结束！', canvas.width / 2, canvas.height / 2 - 20);
            ctx.font = '20px Microsoft YaHei';
            ctx.fillText(`最终得分: ${score}`, canvas.width / 2, canvas.height / 2 + 20);
            document.getElementById('startBtn').textContent = '重新开始';
        }
        
        function togglePause() {
            if (!gameRunning) return;
            gamePaused = !gamePaused;
            if (!gamePaused) {
                gameLoop();
            }
        }
        
        function updateUI() {
            document.getElementById('score').textContent = score;
            document.getElementById('level').textContent = level;
            document.getElementById('lives').textContent = lives;
        }
        
        // 初始绘制
        draw();
        ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        ctx.fillStyle = 'white';
        ctx.font = '24px Microsoft YaHei';
        ctx.textAlign = 'center';
        ctx.fillText('点击"开始游戏"按钮开始', canvas.width / 2, canvas.height / 2);
    </script>
</body>
</html>