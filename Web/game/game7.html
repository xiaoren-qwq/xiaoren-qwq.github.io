<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è°æ˜¯å§åº•</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }
        .header {
            background: rgba(255,255,255,0.1);
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            max-width: 900px;
            backdrop-filter: blur(10px);
            border-radius: 15px;
            margin-bottom: 20px;
        }
        .header h1 { color: white; font-size: 24px; }
        .game-container {
            width: 100%;
            max-width: 900px;
        }
        .setup-panel {
            background: rgba(255,255,255,0.95);
            padding: 30px;
            border-radius: 15px;
            text-align: center;
        }
        .setup-panel h2 {
            color: #667eea;
            margin-bottom: 20px;
        }
        .player-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            margin-bottom: 15px;
        }
        .player-input:focus {
            outline: none;
            border-color: #667eea;
        }
        .player-list {
            margin: 20px 0;
            min-height: 100px;
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
        }
        .player-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: white;
            border-radius: 8px;
            margin-bottom: 8px;
        }
        .player-item span {
            font-weight: bold;
            color: #333;
        }
        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            margin: 5px;
            transition: all 0.3s;
        }
        .btn-start { background: linear-gradient(45deg, #43e97b, #38f9d7); color: white; }
        .btn-add { background: linear-gradient(45deg, #4facfe, #00f2fe); color: white; }
        .btn-remove { background: linear-gradient(45deg, #ff6b6b, #ee5a5a); color: white; }
        .btn-back { background: linear-gradient(45deg, #f093fb, #f5576c); color: white; }
        .btn-vote { background: linear-gradient(45deg, #feca57, #ff9f43); color: white; }
        .btn:hover { transform: scale(1.05); }
        
        .game-panel {
            display: none;
            background: rgba(255,255,255,0.95);
            padding: 30px;
            border-radius: 15px;
        }
        .word-card {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            margin-bottom: 20px;
        }
        .word-card h3 {
            font-size: 18px;
            margin-bottom: 10px;
        }
        .word-card .word {
            font-size: 36px;
            font-weight: bold;
        }
        .players-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .player-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            border: 3px solid transparent;
        }
        .player-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        .player-card.selected {
            border-color: #667eea;
            background: #e3f2fd;
        }
        .player-card.eliminated {
            opacity: 0.5;
            pointer-events: none;
        }
        .player-card .name {
            font-size: 18px;
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
        }
        .player-card .status {
            font-size: 14px;
            color: #666;
        }
        .chat-area {
            margin-top: 20px;
        }
        .chat-messages {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            min-height: 150px;
            max-height: 300px;
            overflow-y: auto;
            margin-bottom: 10px;
        }
        .chat-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
        }
        .chat-input:focus {
            outline: none;
            border-color: #667eea;
        }
        .phase-indicator {
            background: linear-gradient(45deg, #feca57, #ff9f43);
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            display: inline-block;
            margin-bottom: 20px;
            font-weight: bold;
        }
        .result-panel {
            display: none;
            background: rgba(255,255,255,0.95);
            padding: 30px;
            border-radius: 15px;
            text-align: center;
        }
        .result-panel h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 28px;
        }
        .result-panel .winner {
            font-size: 24px;
            color: #43e97b;
            margin-bottom: 20px;
        }
        .result-panel .spy {
            font-size: 20px;
            color: #ff6b6b;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ•µï¸ è°æ˜¯å§åº•</h1>
        <button class="btn btn-back" onclick="location.href='../index.html'">è¿”å›</button>
    </div>
    
    <div class="game-container">
        <!-- è®¾ç½®é¢æ¿ -->
        <div class="setup-panel" id="setupPanel">
            <h2>ğŸ® æ¸¸æˆè®¾ç½®</h2>
            <input type="text" class="player-input" id="playerName" placeholder="è¾“å…¥ç©å®¶åç§°">
            <button class="btn btn-add" onclick="addPlayer()">æ·»åŠ ç©å®¶</button>
            <div class="player-list" id="playerList"></div>
            <p style="color: #666; margin-bottom: 15px;">è‡³å°‘éœ€è¦4åç©å®¶æ‰èƒ½å¼€å§‹æ¸¸æˆ</p>
            <button class="btn btn-start" onclick="startGame()">å¼€å§‹æ¸¸æˆ</button>
        </div>
        
        <!-- æ¸¸æˆé¢æ¿ -->
        <div class="game-panel" id="gamePanel">
            <div class="phase-indicator" id="phaseIndicator">æŸ¥çœ‹è¯è¯­</div>
            
            <div class="word-card" id="wordCard">
                <h3>ä½ çš„è¯è¯­</h3>
                <div class="word" id="currentWord">???</div>
            </div>
            
            <div class="players-grid" id="playersGrid"></div>
            
            <div class="chat-area">
                <div class="chat-messages" id="chatMessages"></div>
                <input type="text" class="chat-input" id="chatInput" placeholder="è¾“å…¥å‘è¨€..." onkeypress="if(event.key==='Enter')sendChat()">
            </div>
            
            <button class="btn btn-vote" onclick="startVoting()" id="voteBtn" style="display: none; margin-top: 15px;">å¼€å§‹æŠ•ç¥¨</button>
        </div>
        
        <!-- ç»“æœé¢æ¿ -->
        <div class="result-panel" id="resultPanel">
            <h2 id="resultTitle">æ¸¸æˆç»“æŸ</h2>
            <div class="winner" id="winnerText"></div>
            <div class="spy" id="spyText"></div>
            <button class="btn btn-start" onclick="resetGame()">å†æ¥ä¸€å±€</button>
        </div>
    </div>

    <script>
        const wordPairs = [
            ['è‹¹æœ', 'é¦™è•‰'],
            ['çŒ«', 'ç‹—'],
            ['å¤ªé˜³', 'æœˆäº®'],
            ['æ±½è½¦', 'è‡ªè¡Œè½¦'],
            ['æ‰‹æœº', 'ç”µè„‘'],
            ['å’–å•¡', 'èŒ¶'],
            ['ä¹¦', 'æ‚å¿—'],
            ['çœ¼é•œ', 'å¢¨é•œ'],
            ['è£™å­', 'è£¤å­'],
            ['è›‹ç³•', 'é¢åŒ…']
        ];
        
        let players = [];
        let currentPlayerIndex = 0;
        let currentPair = [];
        let spyIndex = -1;
        let phase = 'setup';
        let votes = {};
        let eliminatedPlayers = [];
        
        function addPlayer() {
            const nameInput = document.getElementById('playerName');
            const name = nameInput.value.trim();
            
            if (!name) {
                alert('è¯·è¾“å…¥ç©å®¶åç§°');
                return;
            }
            
            if (players.find(p => p.name === name)) {
                alert('è¯¥ç©å®¶å·²å­˜åœ¨');
                return;
            }
            
            players.push({
                name: name,
                word: '',
                isSpy: false,
                eliminated: false
            });
            
            nameInput.value = '';
            updatePlayerList();
        }
        
        function removePlayer(index) {
            players.splice(index, 1);
            updatePlayerList();
        }
        
        function updatePlayerList() {
            const list = document.getElementById('playerList');
            list.innerHTML = '';
            
            players.forEach((player, index) => {
                const item = document.createElement('div');
                item.className = 'player-item';
                item.innerHTML = `
                    <span>${index + 1}. ${player.name}</span>
                    <button class="btn btn-remove" style="padding: 5px 15px; font-size: 12px;" onclick="removePlayer(${index})">ç§»é™¤</button>
                `;
                list.appendChild(item);
            });
        }
        
        function startGame() {
            if (players.length < 4) {
                alert('è‡³å°‘éœ€è¦4åç©å®¶æ‰èƒ½å¼€å§‹æ¸¸æˆ');
                return;
            }
            
            // éšæœºé€‰æ‹©è¯è¯­å¯¹
            currentPair = wordPairs[Math.floor(Math.random() * wordPairs.length)];
            
            // éšæœºé€‰æ‹©å§åº•
            spyIndex = Math.floor(Math.random() * players.length);
            
            // åˆ†é…è¯è¯­
            players.forEach((player, index) => {
                player.isSpy = index === spyIndex;
                player.word = player.isSpy ? currentPair[1] : currentPair[0];
                player.eliminated = false;
            });
            
            eliminatedPlayers = [];
            currentPlayerIndex = 0;
            phase = 'viewWords';
            
            document.getElementById('setupPanel').style.display = 'none';
            document.getElementById('gamePanel').style.display = 'block';
            
            showPlayerWord();
            updatePlayersGrid();
            document.getElementById('chatMessages').innerHTML = '<div style="color: #666; text-align: center;">æ¸¸æˆå¼€å§‹ï¼è¯·ä¾æ¬¡æŸ¥çœ‹è‡ªå·±çš„è¯è¯­</div>';
        }
        
        function showPlayerWord() {
            const player = players[currentPlayerIndex];
            document.getElementById('currentWord').textContent = player.word;
            document.getElementById('phaseIndicator').textContent = `${player.name} æŸ¥çœ‹è¯è¯­`;
        }
        
        function nextPlayer() {
            currentPlayerIndex++;
            
            if (currentPlayerIndex >= players.length) {
                phase = 'discussion';
                document.getElementById('wordCard').style.display = 'none';
                document.getElementById('phaseIndicator').textContent = 'è®¨è®ºé˜¶æ®µ';
                document.getElementById('voteBtn').style.display = 'inline-block';
                document.getElementById('chatMessages').innerHTML += '<div style="color: #43e97b; text-align: center; margin-top: 10px;">--- æ‰€æœ‰ç©å®¶å·²æŸ¥çœ‹è¯è¯­ï¼Œå¼€å§‹è®¨è®º ---</div>';
            } else {
                showPlayerWord();
            }
        }
        
        function updatePlayersGrid() {
            const grid = document.getElementById('playersGrid');
            grid.innerHTML = '';
            
            players.forEach((player, index) => {
                const card = document.createElement('div');
                card.className = 'player-card' + (player.eliminated ? ' eliminated' : '');
                card.innerHTML = `
                    <div class="name">${player.name}</div>
                    <div class="status">${player.eliminated ? 'å·²æ·˜æ±°' : 'å­˜æ´»'}</div>
                `;
                
                if (phase === 'voting' && !player.eliminated) {
                    card.onclick = () => vote(index);
                    card.style.cursor = 'pointer';
                }
                
                grid.appendChild(card);
            });
        }
        
        function sendChat() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            const messages = document.getElementById('chatMessages');
            const msgDiv = document.createElement('div');
            msgDiv.style.padding = '8px';
            msgDiv.style.marginBottom = '5px';
            msgDiv.style.borderBottom = '1px solid #e0e0e0';
            msgDiv.innerHTML = `<strong style="color: #667eea;">${players[currentPlayerIndex].name}:</strong> ${message}`;
            messages.appendChild(msgDiv);
            messages.scrollTop = messages.scrollHeight;
            
            input.value = '';
            
            // åˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ªç©å®¶å‘è¨€
            currentPlayerIndex = (currentPlayerIndex + 1) % players.filter(p => !p.eliminated).length;
            document.getElementById('phaseIndicator').textContent = `${players[currentPlayerIndex].name} å‘è¨€`;
        }
        
        function startVoting() {
            phase = 'voting';
            votes = {};
            document.getElementById('phaseIndicator').textContent = 'æŠ•ç¥¨é˜¶æ®µ - é€‰æ‹©è¦æ·˜æ±°çš„ç©å®¶';
            document.getElementById('voteBtn').style.display = 'none';
            document.getElementById('chatInput').disabled = true;
            document.getElementById('chatMessages').innerHTML += '<div style="color: #feca57; text-align: center; margin-top: 10px;">--- æŠ•ç¥¨é˜¶æ®µå¼€å§‹ï¼Œç‚¹å‡»ç©å®¶å¡ç‰‡æŠ•ç¥¨ ---</div>';
            updatePlayersGrid();
        }
        
        function vote(targetIndex) {
            votes[targetIndex] = (votes[targetIndex] || 0) + 1;
            
            const player = players[targetIndex];
            player.eliminated = true;
            eliminatedPlayers.push(targetIndex);
            
            document.getElementById('chatMessages').innerHTML += `<div style="color: #ff6b6b; text-align: center; margin-top: 10px;">--- ${player.name} è¢«æŠ•ç¥¨æ·˜æ±° ---</div>`;
            
            checkWinCondition();
        }
        
        function checkWinCondition() {
            const alivePlayers = players.filter(p => !p.eliminated);
            const aliveSpies = alivePlayers.filter(p => p.isSpy);
            
            if (alivePlayers.length <= 2) {
                // å§åº•è·èƒœ
                endGame('spy');
            } else if (aliveSpies.length === 0) {
                // å¹³æ°‘è·èƒœ
                endGame('civilian');
            } else {
                updatePlayersGrid();
            }
        }
        
        function endGame(winner) {
            phase = 'ended';
            
            document.getElementById('gamePanel').style.display = 'none';
            document.getElementById('resultPanel').style.display = 'block';
            
            const spyPlayer = players[spyIndex];
            
            if (winner === 'spy') {
                document.getElementById('resultTitle').textContent = 'ğŸ­ å§åº•è·èƒœï¼';
                document.getElementById('winnerText').textContent = 'å§åº•æˆåŠŸéšè—åˆ°æœ€åï¼';
            } else {
                document.getElementById('resultTitle').textContent = 'ğŸ‰ å¹³æ°‘è·èƒœï¼';
                document.getElementById('winnerText').textContent = 'å¹³æ°‘æˆåŠŸæ‰¾å‡ºå§åº•ï¼';
            }
            
            document.getElementById('spyText').innerHTML = `å§åº•æ˜¯: <strong>${spyPlayer.name}</strong><br>å§åº•è¯è¯­: <strong>${spyPlayer.word}</strong><br>å¹³æ°‘è¯è¯­: <strong>${currentPair[0]}</strong>`;
        }
        
        function resetGame() {
            players = [];
            currentPlayerIndex = 0;
            phase = 'setup';
            votes = {};
            eliminatedPlayers = [];
            
            document.getElementById('setupPanel').style.display = 'block';
            document.getElementById('gamePanel').style.display = 'none';
            document.getElementById('resultPanel').style.display = 'none';
            document.getElementById('wordCard').style.display = 'block';
            document.getElementById('chatInput').disabled = false;
            document.getElementById('playerName').value = '';
            
            updatePlayerList();
        }
    </script>
</body>
</html>