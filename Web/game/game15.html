<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å€’æ”¾çŒœæ­Œ</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }
        .header {
            background: rgba(255,255,255,0.1);
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            max-width: 700px;
            backdrop-filter: blur(10px);
            border-radius: 15px;
            margin-bottom: 20px;
        }
        .header h1 { color: white; font-size: 24px; }
        .game-info { color: white; font-size: 14px; }
        .game-container {
            width: 100%;
            max-width: 700px;
            background: rgba(255,255,255,0.95);
            padding: 30px;
            border-radius: 15px;
            text-align: center;
        }
        .music-player {
            background: linear-gradient(135deg, #667eea, #764ba2);
            padding: 40px;
            border-radius: 20px;
            margin-bottom: 30px;
        }
        .music-icon {
            font-size: 80px;
            margin-bottom: 20px;
            animation: pulse 2s ease-in-out infinite;
        }
        .melody-display {
            background: rgba(255, 255, 255, 0.2);
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
        }
        .melody-label {
            color: white;
            font-size: 14px;
            margin-bottom: 10px;
            opacity: 0.9;
        }
        .melody-notes {
            color: white;
            font-size: 32px;
            font-weight: bold;
            letter-spacing: 5px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        .melody-note {
            display: inline-block;
            animation: notePlay 0.3s ease-in-out;
        }
        @keyframes notePlay {
            0% { transform: scale(1); color: white; }
            50% { transform: scale(1.3); color: #ffd700; }
            100% { transform: scale(1); color: white; }
        }
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        .music-status {
            color: white;
            font-size: 18px;
            margin-bottom: 15px;
        }
        .play-btn {
            background: white;
            color: #667eea;
            border: none;
            padding: 15px 40px;
            border-radius: 30px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        .play-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
        }
        .play-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        .answer-area {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 20px;
        }
        .answer-area h3 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 18px;
        }
        .options-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 15px;
        }
        .option-btn {
            padding: 15px;
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
        }
        .option-btn:hover {
            border-color: #667eea;
            background: #f0f4ff;
        }
        .option-btn.correct {
            background: #43e97b;
            border-color: #43e97b;
            color: white;
        }
        .option-btn.wrong {
            background: #ff6b6b;
            border-color: #ff6b6b;
            color: white;
        }
        .message {
            color: #667eea;
            font-size: 18px;
            margin-top: 15px;
            min-height: 24px;
        }
        .controls {
            margin-top: 20px;
        }
        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            margin: 5px;
            transition: all 0.3s;
        }
        .btn-start { background: linear-gradient(45deg, #43e97b, #38f9d7); color: white; }
        .btn-next { background: linear-gradient(45deg, #feca57, #ff9f43); color: white; }
        .btn-back { background: linear-gradient(45deg, #f093fb, #f5576c); color: white; }
        .btn:hover { transform: scale(1.05); }
        .song-info {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            display: none;
        }
        .song-info h4 {
            color: #667eea;
            margin-bottom: 10px;
        }
        .song-info p {
            color: #333;
            margin: 5px 0;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸµ å€’æ”¾çŒœæ­Œ</h1>
        <div class="game-info">
            åˆ†æ•°: <span id="score">0</span> | ç¬¬ <span id="round">1</span> é¦–
        </div>
        <button class="btn btn-back" onclick="location.href='../index.html'">è¿”å›</button>
    </div>
    
    <div class="game-container">
        <div class="music-player">
            <div class="music-icon" id="musicIcon">ğŸµ</div>
            <div class="music-status" id="musicStatus">ç‚¹å‡»æ’­æ”¾æŒ‰é’®å¬æ­Œ</div>
            <div class="melody-display" id="melodyDisplay" style="display: none;">
                <div class="melody-label">ğŸ¼ å€’æ”¾æ—‹å¾‹ï¼š</div>
                <div class="melody-notes" id="melodyNotes"></div>
            </div>
            <button class="play-btn" id="playBtn" onclick="playMusic()">â–¶ï¸ æ’­æ”¾å€’æ”¾éŸ³ä¹</button>
        </div>
        
        <div class="answer-area">
            <h3>ğŸ¤” è¿™æ˜¯å“ªé¦–æ­Œï¼Ÿ</h3>
            <div class="options-grid" id="optionsGrid"></div>
        </div>
        
        <div class="song-info" id="songInfo">
            <h4>ğŸµ æ­Œæ›²ä¿¡æ¯</h4>
            <p><strong>æ­Œå:</strong> <span id="songName"></span></p>
            <p><strong>æ­Œæ‰‹:</strong> <span id="songArtist"></span></p>
        </div>
        
        <div class="message" id="message"></div>
        
        <div class="controls">
            <button class="btn btn-start" id="startBtn" onclick="startGame()">å¼€å§‹æ¸¸æˆ</button>
            <button class="btn btn-next" id="nextBtn" onclick="nextSong()" style="display: none;">â¡ï¸ ä¸‹ä¸€é¦–</button>
        </div>
    </div>

    <script>
        const songs = [
            { name: 'å°æ˜Ÿæ˜Ÿ', artist: 'å„¿æ­Œ', melody: '1155665' },
            { name: 'ä¸¤åªè€è™', artist: 'å„¿æ­Œ', melody: '1231' },
            { name: 'ç”Ÿæ—¥å¿«ä¹', artist: 'ä¼ ç»Ÿ', melody: '556517' },
            { name: 'èŒ‰è‰èŠ±', artist: 'æ°‘æ­Œ', melody: '3355' },
            { name: 'æ–°å¹´å¥½', artist: 'å„¿æ­Œ', melody: '11155' },
            { name: 'å°å…”å­ä¹–ä¹–', artist: 'å„¿æ­Œ', melody: '1235' },
            { name: 'ä¸–ä¸Šåªæœ‰å¦ˆå¦ˆå¥½', artist: 'å„¿æ­Œ', melody: '665533' },
            { name: 'æ‰¾æœ‹å‹', artist: 'å„¿æ­Œ', melody: '56535' },
            { name: 'æ‹”èåœ', artist: 'å„¿æ­Œ', melody: '5653' },
            { name: 'è¯»ä¹¦éƒ', artist: 'å„¿æ­Œ', melody: '3565' }
        ];
        
        let gameRunning = false;
        let currentSongIndex = 0;
        let score = 0;
        let round = 1;
        let answered = false;
        let audioContext = null;
        
        function initGame() {
            answered = false;
            const song = songs[currentSongIndex];
            
            document.getElementById('musicStatus').textContent = 'ç‚¹å‡»æ’­æ”¾æŒ‰é’®å¬æ­Œ';
            document.getElementById('playBtn').disabled = false;
            document.getElementById('songInfo').style.display = 'none';
            document.getElementById('melodyDisplay').style.display = 'none';
            document.getElementById('message').textContent = '';
            
            // åˆ›å»ºé€‰é¡¹
            const optionsGrid = document.getElementById('optionsGrid');
            optionsGrid.innerHTML = '';
            
            // è·å–å½“å‰æ­Œæ›²å’Œ3ä¸ªéšæœºæ­Œæ›²
            let options = [song];
            const otherSongs = songs.filter((s, i) => i !== currentSongIndex);
            const shuffled = otherSongs.sort(() => Math.random() - 0.5);
            options = options.concat(shuffled.slice(0, 3));
            options = options.sort(() => Math.random() - 0.5);
            
            options.forEach((option, index) => {
                const btn = document.createElement('button');
                btn.className = 'option-btn';
                btn.textContent = `${option.name} - ${option.artist}`;
                btn.onclick = () => checkAnswer(option.name, btn);
                optionsGrid.appendChild(btn);
            });
        }
        
        function playMusic() {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            }
            
            const song = songs[currentSongIndex];
            const melody = song.melody;
            
            // å€’æ”¾æ—‹å¾‹
            const reversedMelody = melody.split('').reverse().join('');
            
            // æ˜¾ç¤ºæ—‹å¾‹
            document.getElementById('melodyDisplay').style.display = 'block';
            const melodyNotesDiv = document.getElementById('melodyNotes');
            melodyNotesDiv.innerHTML = '';
            reversedMelody.split('').forEach((note, index) => {
                const noteSpan = document.createElement('span');
                noteSpan.className = 'melody-note';
                noteSpan.textContent = note;
                noteSpan.style.animationDelay = (index * 0.3) + 's';
                melodyNotesDiv.appendChild(noteSpan);
            });
            
            document.getElementById('musicStatus').textContent = 'æ­£åœ¨æ’­æ”¾å€’æ”¾éŸ³ä¹...';
            document.getElementById('musicIcon').style.animation = 'pulse 0.5s ease-in-out infinite';
            document.getElementById('playBtn').disabled = true;
            
            playMelody(reversedMelody);
        }
        
        function playMelody(notes) {
            const noteFrequencies = {
                '1': 261.63, '2': 293.66, '3': 329.63, '4': 349.23,
                '5': 392.00, '6': 440.00, '7': 493.88
            };
            
            let time = audioContext.currentTime;
            const noteDuration = 0.3;
            
            notes.split('').forEach((note, index) => {
                if (noteFrequencies[note]) {
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);
                    
                    oscillator.frequency.value = noteFrequencies[note];
                    oscillator.type = 'sine';
                    
                    gainNode.gain.setValueAtTime(0.3, time);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, time + noteDuration);
                    
                    oscillator.start(time);
                    oscillator.stop(time + noteDuration);
                    
                    time += noteDuration;
                }
            });
            
            // æ’­æ”¾ç»“æŸ
            setTimeout(() => {
                document.getElementById('musicStatus').textContent = 'æ’­æ”¾å®Œæˆï¼Œè¯·é€‰æ‹©ç­”æ¡ˆ';
                document.getElementById('musicIcon').style.animation = 'pulse 2s ease-in-out infinite';
                document.getElementById('playBtn').disabled = false;
                document.getElementById('playBtn').textContent = 'ğŸ”„ å†å¬ä¸€æ¬¡';
            }, notes.length * noteDuration * 1000 + 100);
        }
        
        function checkAnswer(answer, btn) {
            if (answered) return;
            answered = true;
            
            const song = songs[currentSongIndex];
            const buttons = document.querySelectorAll('.option-btn');
            
            buttons.forEach(b => {
                b.disabled = true;
                if (b.textContent.includes(song.name)) {
                    b.classList.add('correct');
                }
            });
            
            if (answer === song.name) {
                btn.classList.add('correct');
                score += 10;
                document.getElementById('message').textContent = 'ğŸ‰ ç­”å¯¹äº†ï¼';
                
                // æ˜¾ç¤ºæ­Œæ›²ä¿¡æ¯
                document.getElementById('songInfo').style.display = 'block';
                document.getElementById('songName').textContent = song.name;
                document.getElementById('songArtist').textContent = song.artist;
            } else {
                btn.classList.add('wrong');
                document.getElementById('message').textContent = 'âŒ ç­”é”™äº†ï¼';
            }
            
            document.getElementById('score').textContent = score;
            document.getElementById('nextBtn').style.display = 'inline-block';
        }
        
        function nextSong() {
            currentSongIndex++;
            round++;
            
            if (currentSongIndex >= songs.length) {
                gameComplete();
                return;
            }
            
            document.getElementById('round').textContent = round;
            document.getElementById('nextBtn').style.display = 'none';
            document.getElementById('playBtn').textContent = 'â–¶ï¸ æ’­æ”¾å€’æ”¾éŸ³ä¹';
            
            initGame();
        }
        
        function startGame() {
            if (gameRunning) return;
            
            gameRunning = true;
            score = 0;
            round = 1;
            currentSongIndex = 0;
            
            document.getElementById('score').textContent = score;
            document.getElementById('round').textContent = round;
            document.getElementById('startBtn').textContent = 'æ¸¸æˆä¸­...';
            document.getElementById('startBtn').style.display = 'none';
            
            initGame();
        }
        
        function gameComplete() {
            gameRunning = false;
            
            document.getElementById('musicStatus').textContent = 'æ¸¸æˆç»“æŸï¼';
            document.getElementById('playBtn').disabled = true;
            document.getElementById('nextBtn').style.display = 'none';
            document.getElementById('startBtn').textContent = 'é‡æ–°å¼€å§‹';
            document.getElementById('startBtn').style.display = 'inline-block';
            
            document.getElementById('message').textContent = `ğŸŠ æ¸¸æˆå®Œæˆï¼æœ€ç»ˆå¾—åˆ†: ${score}`;
            
            const optionsGrid = document.getElementById('optionsGrid');
            optionsGrid.innerHTML = '<p style="grid-column: span 2; color: #666;">æ‰€æœ‰æ­Œæ›²å·²çŒœå®Œ</p>';
        }
    </script>
</body>
</html>