<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¤å¤æ‰“ç –å—</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            overflow: hidden;
        }
        .header {
            background: rgba(255,255,255,0.1);
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            backdrop-filter: blur(10px);
        }
        .header h1 { color: white; font-size: 24px; }
        .game-info { color: white; font-size: 14px; }
        .game-container {
            position: relative;
            margin-top: 20px;
        }
        canvas {
            border: 3px solid #667eea;
            border-radius: 10px;
            box-shadow: 0 0 30px rgba(102, 126, 234, 0.5);
        }
        .controls {
            margin-top: 20px;
            text-align: center;
            color: white;
        }
        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            margin: 5px;
            transition: all 0.3s;
        }
        .btn-start { background: linear-gradient(45deg, #43e97b, #38f9d7); color: white; }
        .btn-back { background: linear-gradient(45deg, #f093fb, #f5576c); color: white; }
        .btn:hover { transform: scale(1.05); }
        .instructions {
            color: rgba(255,255,255,0.7);
            font-size: 12px;
            margin-top: 15px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ å¤å¤æ‰“ç –å—</h1>
        <div class="game-info">
            åˆ†æ•°: <span id="score">0</span> | å…³å¡: <span id="level">1</span> | ç”Ÿå‘½: <span id="lives">3</span>
        </div>
        <button class="btn btn-back" onclick="location.href='../index.html'">è¿”å›</button>
    </div>
    
    <div class="game-container">
        <canvas id="gameCanvas" width="600" height="500"></canvas>
    </div>
    
    <div class="controls">
        <button class="btn btn-start" id="startBtn" onclick="startGame()">å¼€å§‹æ¸¸æˆ</button>
        <div class="instructions">
            ä½¿ç”¨ â† â†’ æ–¹å‘é”®æˆ–é¼ æ ‡ç§»åŠ¨æŒ¡æ¿ | ç©ºæ ¼é”®å‘å°„çƒ | P æš‚åœ
        </div>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        
        let gameRunning = false;
        let gamePaused = false;
        let score = 0;
        let level = 1;
        let lives = 3;
        let ballLaunched = false;
        
        const paddle = {
            width: 100,
            height: 15,
            x: 250,
            y: 470,
            speed: 8,
            color: '#4facfe'
        };
        
        const ball = {
            x: 300,
            y: 455,
            radius: 8,
            speed: 5,
            dx: 5,
            dy: -5,
            color: '#feca57'
        };
        
        const brickConfig = {
            rows: 5,
            cols: 10,
            width: 50,
            height: 20,
            padding: 8,
            offsetTop: 50,
            offsetLeft: 30
        };
        
        let bricks = [];
        
        const brickColors = ['#ff6b6b', '#feca57', '#43e97b', '#4facfe', '#a55eea'];
        
        function initBricks() {
            bricks = [];
            for (let r = 0; r < brickConfig.rows; r++) {
                bricks[r] = [];
                for (let c = 0; c < brickConfig.cols; c++) {
                    const hits = r < 2 ? 2 : 1; // å‰ä¸¤è¡Œéœ€è¦æ‰“ä¸¤æ¬¡
                    bricks[r][c] = {
                        x: c * (brickConfig.width + brickConfig.padding) + brickConfig.offsetLeft,
                        y: r * (brickConfig.height + brickConfig.padding) + brickConfig.offsetTop,
                        status: 1,
                        hits: hits,
                        maxHits: hits,
                        color: brickColors[r]
                    };
                }
            }
        }
        
        const keys = {};
        
        document.addEventListener('keydown', (e) => {
            keys[e.key] = true;
            if (e.key === ' ') {
                e.preventDefault();
                if (gameRunning && !gamePaused && !ballLaunched) {
                    launchBall();
                }
            }
            if (e.key === 'p' || e.key === 'P') {
                togglePause();
            }
        });
        
        document.addEventListener('keyup', (e) => {
            keys[e.key] = false;
        });
        
        canvas.addEventListener('mousemove', (e) => {
            if (!gameRunning || gamePaused) return;
            const rect = canvas.getBoundingClientRect();
            const mouseX = e.clientX - rect.left;
            paddle.x = mouseX - paddle.width / 2;
            
            if (paddle.x < 0) paddle.x = 0;
            if (paddle.x + paddle.width > canvas.width) {
                paddle.x = canvas.width - paddle.width;
            }
        });
        
        function launchBall() {
            ballLaunched = true;
            ball.dx = (Math.random() - 0.5) * 6;
            ball.dy = -ball.speed;
        }
        
        function update() {
            if (!gameRunning || gamePaused) return;
            
            // ç§»åŠ¨æŒ¡æ¿
            if ((keys['ArrowLeft'] || keys['a'] || keys['A']) && paddle.x > 0) {
                paddle.x -= paddle.speed;
            }
            if ((keys['ArrowRight'] || keys['d'] || keys['D']) && paddle.x < canvas.width - paddle.width) {
                paddle.x += paddle.speed;
            }
            
            // çƒæœªå‘å°„æ—¶è·ŸéšæŒ¡æ¿
            if (!ballLaunched) {
                ball.x = paddle.x + paddle.width / 2;
                ball.y = paddle.y - ball.radius;
                return;
            }
            
            // ç§»åŠ¨çƒ
            ball.x += ball.dx;
            ball.y += ball.dy;
            
            // å¢™å£ç¢°æ’
            if (ball.x + ball.radius > canvas.width || ball.x - ball.radius < 0) {
                ball.dx = -ball.dx;
            }
            if (ball.y - ball.radius < 0) {
                ball.dy = -ball.dy;
            }
            
            // æŒ¡æ¿ç¢°æ’
            if (ball.y + ball.radius > paddle.y &&
                ball.y - ball.radius < paddle.y + paddle.height &&
                ball.x > paddle.x &&
                ball.x < paddle.x + paddle.width) {
                
                ball.dy = -Math.abs(ball.dy);
                
                // æ ¹æ®å‡»ä¸­ä½ç½®è°ƒæ•´è§’åº¦
                const hitPos = (ball.x - paddle.x) / paddle.width;
                ball.dx = (hitPos - 0.5) * 10;
            }
            
            // ç –å—ç¢°æ’
            for (let r = 0; r < brickConfig.rows; r++) {
                for (let c = 0; c < brickConfig.cols; c++) {
                    const brick = bricks[r][c];
                    if (brick.status === 1) {
                        if (ball.x > brick.x &&
                            ball.x < brick.x + brickConfig.width &&
                            ball.y > brick.y &&
                            ball.y < brick.y + brickConfig.height) {
                            
                            ball.dy = -ball.dy;
                            brick.hits--;
                            
                            if (brick.hits <= 0) {
                                brick.status = 0;
                                score += 10 * brick.maxHits;
                            } else {
                                score += 5;
                            }
                            
                            updateUI();
                            checkWin();
                            return;
                        }
                    }
                }
            }
            
            // çƒæ‰è½
            if (ball.y + ball.radius > canvas.height) {
                lives--;
                updateUI();
                
                if (lives <= 0) {
                    gameOver();
                } else {
                    resetBall();
                }
            }
        }
        
        function draw() {
            // æ¸…ç©ºç”»å¸ƒ
            ctx.fillStyle = '#1a1a2e';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // ç»˜åˆ¶ç –å—
            for (let r = 0; r < brickConfig.rows; r++) {
                for (let c = 0; c < brickConfig.cols; c++) {
                    const brick = bricks[r][c];
                    if (brick.status === 1) {
                        ctx.fillStyle = brick.color;
                        ctx.fillRect(brick.x, brick.y, brickConfig.width, brickConfig.height);
                        
                        // ç –å—é«˜å…‰
                        ctx.fillStyle = 'rgba(255, 255, 255, 0.3)';
                        ctx.fillRect(brick.x, brick.y, brickConfig.width, 3);
                        
                        // ç –å—é˜´å½±
                        ctx.fillStyle = 'rgba(0, 0, 0, 0.3)';
                        ctx.fillRect(brick.x, brick.y + brickConfig.height - 3, brickConfig.width, 3);
                        
                        // æ˜¾ç¤ºéœ€è¦æ‰“å‡ æ¬¡
                        if (brick.maxHits > 1) {
                            ctx.fillStyle = 'white';
                            ctx.font = 'bold 12px Arial';
                            ctx.textAlign = 'center';
                            ctx.fillText(brick.hits, brick.x + brickConfig.width / 2, brick.y + brickConfig.height / 2 + 4);
                        }
                    }
                }
            }
            
            // ç»˜åˆ¶æŒ¡æ¿
            ctx.fillStyle = paddle.color;
            ctx.beginPath();
            ctx.roundRect(paddle.x, paddle.y, paddle.width, paddle.height, 5);
            ctx.fill();
            
            // æŒ¡æ¿é«˜å…‰
            ctx.fillStyle = 'rgba(255, 255, 255, 0.3)';
            ctx.beginPath();
            ctx.roundRect(paddle.x, paddle.y, paddle.width, 5, 5);
            ctx.fill();
            
            // ç»˜åˆ¶çƒ
            ctx.fillStyle = ball.color;
            ctx.beginPath();
            ctx.arc(ball.x, ball.y, ball.radius, 0, Math.PI * 2);
            ctx.fill();
            
            // çƒé«˜å…‰
            ctx.fillStyle = 'rgba(255, 255, 255, 0.5)';
            ctx.beginPath();
            ctx.arc(ball.x - 2, ball.y - 2, 3, 0, Math.PI * 2);
            ctx.fill();
            
            // æš‚åœæç¤º
            if (gamePaused) {
                ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                ctx.fillStyle = 'white';
                ctx.font = '30px Microsoft YaHei';
                ctx.textAlign = 'center';
                ctx.fillText('æ¸¸æˆæš‚åœ', canvas.width / 2, canvas.height / 2);
            }
        }
        
        function gameLoop() {
            update();
            draw();
            if (gameRunning) {
                requestAnimationFrame(gameLoop);
            }
        }
        
        function resetBall() {
            ballLaunched = false;
            ball.x = paddle.x + paddle.width / 2;
            ball.y = paddle.y - ball.radius;
            ball.dx = 5;
            ball.dy = -5;
        }
        
        function checkWin() {
            let allDestroyed = true;
            for (let r = 0; r < brickConfig.rows; r++) {
                for (let c = 0; c < brickConfig.cols; c++) {
                    if (bricks[r][c].status === 1) {
                        allDestroyed = false;
                        break;
                    }
                }
            }
            
            if (allDestroyed) {
                levelComplete();
            }
        }
        
        function levelComplete() {
            level++;
            ball.speed += 0.5;
            initBricks();
            resetBall();
            updateUI();
            
            // æ˜¾ç¤ºè¿‡å…³æç¤º
            ctx.fillStyle = 'rgba(0, 0, 0, 0.8)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = '#43e97b';
            ctx.font = '30px Microsoft YaHei';
            ctx.textAlign = 'center';
            ctx.fillText('ğŸ‰ å…³å¡å®Œæˆï¼', canvas.width / 2, canvas.height / 2);
            
            setTimeout(() => {
                if (gameRunning) {
                    gameLoop();
                }
            }, 2000);
        }
        
        function startGame() {
            if (gameRunning) return;
            
            gameRunning = true;
            gamePaused = false;
            score = 0;
            level = 1;
            lives = 3;
            ball.speed = 5;
            
            paddle.x = 250;
            initBricks();
            resetBall();
            updateUI();
            
            document.getElementById('startBtn').textContent = 'æ¸¸æˆä¸­...';
            gameLoop();
        }
        
        function gameOver() {
            gameRunning = false;
            ctx.fillStyle = 'rgba(0, 0, 0, 0.8)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = 'white';
            ctx.font = '30px Microsoft YaHei';
            ctx.textAlign = 'center';
            ctx.fillText('æ¸¸æˆç»“æŸï¼', canvas.width / 2, canvas.height / 2 - 20);
            ctx.font = '20px Microsoft YaHei';
            ctx.fillText(`æœ€ç»ˆå¾—åˆ†: ${score}`, canvas.width / 2, canvas.height / 2 + 20);
            document.getElementById('startBtn').textContent = 'é‡æ–°å¼€å§‹';
        }
        
        function togglePause() {
            if (!gameRunning) return;
            gamePaused = !gamePaused;
            if (!gamePaused) {
                gameLoop();
            }
        }
        
        function updateUI() {
            document.getElementById('score').textContent = score;
            document.getElementById('level').textContent = level;
            document.getElementById('lives').textContent = lives;
        }
        
        // åˆå§‹ç»˜åˆ¶
        initBricks();
        draw();
        ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        ctx.fillStyle = 'white';
        ctx.font = '24px Microsoft YaHei';
        ctx.textAlign = 'center';
        ctx.fillText('ç‚¹å‡»"å¼€å§‹æ¸¸æˆ"æŒ‰é’®å¼€å§‹', canvas.width / 2, canvas.height / 2);
        ctx.font = '16px Microsoft YaHei';
        ctx.fillText('æŒ‰ç©ºæ ¼é”®å‘å°„çƒ', canvas.width / 2, canvas.height / 2 + 30);
    </script>
</body>
</html>