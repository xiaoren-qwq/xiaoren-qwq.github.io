<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ•°å­—æ‹†å¼¹ä¸“å®¶</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            overflow: hidden;
        }
        .header {
            background: rgba(255,255,255,0.1);
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            backdrop-filter: blur(10px);
        }
        .header h1 { color: white; font-size: 24px; }
        .game-info { color: white; font-size: 14px; }
        .game-container {
            position: relative;
            margin-top: 20px;
        }
        canvas {
            border: 3px solid #667eea;
            border-radius: 10px;
            box-shadow: 0 0 30px rgba(102, 126, 234, 0.5);
        }
        .controls {
            margin-top: 20px;
            text-align: center;
            color: white;
        }
        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            margin: 5px;
            transition: all 0.3s;
        }
        .btn-start { background: linear-gradient(45deg, #43e97b, #38f9d7); color: white; }
        .btn-back { background: linear-gradient(45deg, #f093fb, #f5576c); color: white; }
        .btn-hint { background: linear-gradient(45deg, #feca57, #ff9f43); color: white; }
        .btn:hover { transform: scale(1.05); }
        .instructions {
            color: rgba(255,255,255,0.7);
            font-size: 12px;
            margin-top: 15px;
        }
        .message {
            color: #feca57;
            font-size: 16px;
            margin-top: 10px;
            min-height: 24px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ’£ æ•°å­—æ‹†å¼¹ä¸“å®¶</h1>
        <div class="game-info">
            å‰©ä½™æ—¶é—´: <span id="timer">60</span>ç§’ | å…³å¡: <span id="level">1</span>
        </div>
        <button class="btn btn-back" onclick="location.href='../index.html'">è¿”å›</button>
    </div>
    
    <div class="game-container">
        <canvas id="gameCanvas" width="600" height="500"></canvas>
    </div>
    
    <div class="controls">
        <button class="btn btn-start" id="startBtn" onclick="startGame()">å¼€å§‹æ¸¸æˆ</button>
        <button class="btn btn-hint" id="hintBtn" onclick="getHint()" style="display: none;">ğŸ’¡ æç¤º</button>
        <div class="message" id="message"></div>
        <div class="instructions">
            ç‚¹å‡»æ•°å­—æŒ‰é’®è¾“å…¥å¯†ç  | æ ¹æ®æç¤ºæ‰¾å‡ºæ­£ç¡®å¯†ç  | å€’è®¡æ—¶ç»“æŸå‰æ‹†å¼¹æˆåŠŸ
        </div>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        
        let gameRunning = false;
        let timer = 60;
        let level = 1;
        let currentInput = '';
        let correctPassword = '';
        let hints = [];
        let hintsUsed = 0;
        let timerInterval;
        
        const buttons = [];
        const buttonWidth = 60;
        const buttonHeight = 60;
        const startX = 120;
        const startY = 150;
        
        // åˆå§‹åŒ–æ•°å­—æŒ‰é’®
        function initButtons() {
            buttons.length = 0;
            for (let i = 0; i < 10; i++) {
                buttons.push({
                    x: startX + (i % 3) * (buttonWidth + 20),
                    y: startY + Math.floor(i / 3) * (buttonHeight + 20),
                    width: buttonWidth,
                    height: buttonHeight,
                    value: i === 9 ? 0 : i + 1,
                    color: '#4facfe'
                });
            }
            // æ·»åŠ æ¸…é™¤æŒ‰é’®
            buttons.push({
                x: startX + 2 * (buttonWidth + 20),
                y: startY + 3 * (buttonHeight + 20),
                width: buttonWidth,
                height: buttonHeight,
                value: 'C',
                color: '#ff6b6b'
            });
            // æ·»åŠ ç¡®è®¤æŒ‰é’®
            buttons.push({
                x: startX + (buttonWidth + 20),
                y: startY + 3 * (buttonHeight + 20),
                width: buttonWidth,
                height: buttonHeight,
                value: 'OK',
                color: '#43e97b'
            });
        }
        
        // ç”Ÿæˆå¯†ç å’Œæç¤º
        function generatePassword() {
            const length = 3 + Math.floor(level / 2);
            let password = '';
            for (let i = 0; i < length; i++) {
                password += Math.floor(Math.random() * 10);
            }
            correctPassword = password;
            
            // ç”Ÿæˆæç¤º
            hints = [];
            const hintTypes = [
                () => `å¯†ç é•¿åº¦æ˜¯ ${length} ä½`,
                () => `ç¬¬ä¸€ä½æ•°å­—æ˜¯ ${password[0]}`,
                () => `æœ€åä¸€ä½æ•°å­—æ˜¯ ${password[password.length - 1]}`,
                () => `æ•°å­—ä¹‹å’Œæ˜¯ ${password.split('').reduce((a, b) => a + parseInt(b), 0)}`,
                () => `åŒ…å«æ•°å­— ${password[Math.floor(Math.random() * password.length)]}`,
                () => `æœ€å¤§æ•°å­—æ˜¯ ${Math.max(...password.split('').map(Number))}`,
                () => `æœ€å°æ•°å­—æ˜¯ ${Math.min(...password.split('').map(Number))}`
            ];
            
            // éšæœºé€‰æ‹©æç¤º
            const shuffled = hintTypes.sort(() => Math.random() - 0.5);
            for (let i = 0; i < Math.min(3 + level, shuffled.length); i++) {
                hints.push(shuffled[i]());
            }
        }
        
        canvas.addEventListener('click', (e) => {
            if (!gameRunning) return;
            
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            buttons.forEach(btn => {
                if (x >= btn.x && x <= btn.x + btn.width &&
                    y >= btn.y && y <= btn.y + btn.height) {
                    handleButtonClick(btn.value);
                }
            });
        });
        
        function handleButtonClick(value) {
            if (value === 'C') {
                currentInput = '';
            } else if (value === 'OK') {
                checkPassword();
            } else if (currentInput.length < 5) {
                currentInput += value;
            }
            draw();
        }
        
        function checkPassword() {
            if (currentInput === correctPassword) {
                levelComplete();
            } else {
                showMessage('å¯†ç é”™è¯¯ï¼è¯·é‡è¯•');
                currentInput = '';
                timer = Math.max(timer - 10, 0);
                updateUI();
            }
        }
        
        function getHint() {
            if (hintsUsed < hints.length) {
                showMessage(hints[hintsUsed]);
                hintsUsed++;
                timer = Math.max(timer - 5, 0); // ä½¿ç”¨æç¤ºæ‰£æ—¶é—´
                updateUI();
            } else {
                showMessage('æ²¡æœ‰æ›´å¤šæç¤ºäº†');
            }
        }
        
        function levelComplete() {
            level++;
            timer = Math.max(60, timer + 15);
            currentInput = '';
            hintsUsed = 0;
            generatePassword();
            showMessage('å¯†ç æ­£ç¡®ï¼è¿›å…¥ä¸‹ä¸€å…³');
            updateUI();
            draw();
        }
        
        function showMessage(text) {
            document.getElementById('message').textContent = text;
        }
        
        function update() {
            if (!gameRunning) return;
            
            timer--;
            updateUI();
            
            if (timer <= 0) {
                gameOver();
            }
        }
        
        function draw() {
            // æ¸…ç©ºç”»å¸ƒ
            ctx.fillStyle = '#1a1a2e';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // ç»˜åˆ¶ç‚¸å¼¹
            const bombX = canvas.width / 2;
            const bombY = 80;
            
            // ç‚¸å¼¹ä¸»ä½“
            ctx.fillStyle = '#333';
            ctx.beginPath();
            ctx.arc(bombX, bombY, 40, 0, Math.PI * 2);
            ctx.fill();
            
            // ç‚¸å¼¹é«˜å…‰
            ctx.fillStyle = '#555';
            ctx.beginPath();
            ctx.arc(bombX - 15, bombY - 15, 10, 0, Math.PI * 2);
            ctx.fill();
            
            // å¼•ä¿¡
            ctx.fillStyle = '#8B4513';
            ctx.fillRect(bombX - 5, bombY - 50, 10, 15);
            
            // ç«èŠ±
            const sparkOffset = Math.sin(Date.now() * 0.01) * 5;
            ctx.fillStyle = '#ff6b6b';
            ctx.beginPath();
            ctx.moveTo(bombX, bombY - 50);
            ctx.lineTo(bombX - 8, bombY - 65 + sparkOffset);
            ctx.lineTo(bombX + 8, bombY - 65 + sparkOffset);
            ctx.closePath();
            ctx.fill();
            
            // ç»˜åˆ¶è¾“å…¥æ˜¾ç¤º
            ctx.fillStyle = '#2d3748';
            ctx.fillRect(100, 120, 400, 50);
            ctx.strokeStyle = '#4facfe';
            ctx.lineWidth = 3;
            ctx.strokeRect(100, 120, 400, 50);
            
            ctx.fillStyle = 'white';
            ctx.font = '24px Courier New';
            ctx.textAlign = 'center';
            ctx.fillText(currentInput.padEnd(5, '*'), canvas.width / 2, 153);
            
            // ç»˜åˆ¶æŒ‰é’®
            buttons.forEach(btn => {
                ctx.fillStyle = btn.color;
                ctx.beginPath();
                ctx.roundRect(btn.x, btn.y, btn.width, btn.height, 10);
                ctx.fill();
                
                // æŒ‰é’®é˜´å½±
                ctx.fillStyle = 'rgba(0, 0, 0, 0.3)';
                ctx.beginPath();
                ctx.roundRect(btn.x + 3, btn.y + 3, btn.width, btn.height, 10);
                ctx.fill();
                ctx.fillStyle = btn.color;
                ctx.beginPath();
                ctx.roundRect(btn.x, btn.y, btn.width, btn.height, 10);
                ctx.fill();
                
                ctx.fillStyle = 'white';
                ctx.font = 'bold 24px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(btn.value, btn.x + btn.width / 2, btn.y + btn.height / 2 + 8);
            });
            
            // ç»˜åˆ¶è¿›åº¦æ¡
            const progressWidth = (timer / 60) * 400;
            ctx.fillStyle = '#2d3748';
            ctx.fillRect(100, 420, 400, 20);
            ctx.fillStyle = timer > 20 ? '#43e97b' : '#ff6b6b';
            ctx.fillRect(100, 420, progressWidth, 20);
            
            ctx.fillStyle = 'white';
            ctx.font = '14px Arial';
            ctx.textAlign = 'left';
            ctx.fillText('æ—¶é—´è¿›åº¦', 105, 435);
        }
        
        function gameLoop() {
            update();
            draw();
            if (gameRunning) {
                setTimeout(() => requestAnimationFrame(gameLoop), 1000);
            }
        }
        
        function startGame() {
            if (gameRunning) return;
            
            gameRunning = true;
            timer = 60;
            level = 1;
            currentInput = '';
            hintsUsed = 0;
            
            initButtons();
            generatePassword();
            updateUI();
            
            document.getElementById('startBtn').textContent = 'æ¸¸æˆä¸­...';
            document.getElementById('hintBtn').style.display = 'inline-block';
            gameLoop();
        }
        
        function gameOver() {
            gameRunning = false;
            ctx.fillStyle = 'rgba(0, 0, 0, 0.8)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = '#ff6b6b';
            ctx.font = '30px Microsoft YaHei';
            ctx.textAlign = 'center';
            ctx.fillText('ğŸ’¥ çˆ†ç‚¸äº†ï¼', canvas.width / 2, canvas.height / 2 - 20);
            ctx.fillStyle = 'white';
            ctx.font = '20px Microsoft YaHei';
            ctx.fillText(`ä½ é€šè¿‡äº† ${level - 1} å…³`, canvas.width / 2, canvas.height / 2 + 20);
            ctx.fillText(`æ­£ç¡®å¯†ç æ˜¯: ${correctPassword}`, canvas.width / 2, canvas.height / 2 + 50);
            
            document.getElementById('startBtn').textContent = 'é‡æ–°å¼€å§‹';
            document.getElementById('hintBtn').style.display = 'none';
        }
        
        function updateUI() {
            document.getElementById('timer').textContent = timer;
            document.getElementById('level').textContent = level;
        }
        
        // åˆå§‹ç»˜åˆ¶
        initButtons();
        draw();
        ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        ctx.fillStyle = 'white';
        ctx.font = '24px Microsoft YaHei';
        ctx.textAlign = 'center';
        ctx.fillText('ç‚¹å‡»"å¼€å§‹æ¸¸æˆ"æŒ‰é’®å¼€å§‹', canvas.width / 2, canvas.height / 2);
    </script>
</body>
</html>